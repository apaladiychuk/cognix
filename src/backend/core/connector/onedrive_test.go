package connector

import (
	"cognix.ch/api/v2/core/model"
	"context"
	"github.com/gabriel-vasile/mimetype"
	_ "github.com/gabriel-vasile/mimetype"
	"github.com/shopspring/decimal"
	"github.com/stretchr/testify/assert"
	"testing"
)

var param = model.JSONMap{
	"token": model.JSONMap{
		"access_token":  "eyJ0eXAiOiJKV1QiLCJub25jZSI6Ii1sZG1Ha0Z6ZERoaFBTRDBfZGNJTUJweVN3WFhqUllJa21IS2ZnOWdTTTgiLCJhbGciOiJSUzI1NiIsIng1dCI6IkwxS2ZLRklfam5YYndXYzIyeFp4dzFzVUhIMCIsImtpZCI6IkwxS2ZLRklfam5YYndXYzIyeFp4dzFzVUhIMCJ9.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTAwMDAtYzAwMC0wMDAwMDAwMDAwMDAiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9mYjkxNGJmMy02YWZiLTRhNjMtODUyZS01MmUzMWFiZTZkMTMvIiwiaWF0IjoxNzE2NTM4NzY1LCJuYmYiOjE3MTY1Mzg3NjUsImV4cCI6MTcxNjU0MjY3NCwiYWNjdCI6MCwiYWNyIjoiMSIsImFpbyI6IkFWUUFxLzhXQUFBQW9EYlBqODB6WTNwSVBHejY1aFlwL25TTEhHYzBJYVB6cVBBYkl4Rm92SFRSSjduWjBLb2xyZ3lOb2UvNTVoSjNUajBRY2M3dDRKS0VRcXBFZTdQT3lER1UyK2VIbi9sSDJjd1ZzekxlWEZBPSIsImFtciI6WyJwd2QiLCJtZmEiXSwiYXBwX2Rpc3BsYXluYW1lIjoiQ29nbml4LUFwcCIsImFwcGlkIjoiMjIxNmQ0NTMtNTY1Mi00OTZmLWJhMDktZGE3NDU5YzQ1NGM1IiwiYXBwaWRhY3IiOiIxIiwiZmFtaWx5X25hbWUiOiJQYWxhZGlpY2h1ayIsImdpdmVuX25hbWUiOiJBbmRyaWkiLCJpZHR5cCI6InVzZXIiLCJpcGFkZHIiOiIzMS4yMDIuMTc0LjEzNyIsIm5hbWUiOiJBbmRyaWkgUGFsYWRpaWNodWsiLCJvaWQiOiIwOWMzMDEyMy04ZDYzLTRmY2EtOTA5YS0zYWYwZDNmMDNhNGEiLCJwbGF0ZiI6IjgiLCJwdWlkIjoiMTAwMzIwMDM4MjUxODZCRiIsInJoIjoiMC5BYThBODB1Ui1fdHFZMHFGTGxMakdyNXRFd01BQUFBQUFBQUF3QUFBQUFBQUFBQWRBUW8uIiwic2NwIjoiRmlsZXMuUmVhZC5BbGwgU2VydmljZUFjdGl2aXR5LU9uZURyaXZlLlJlYWQuQWxsIFNpdGVzLlJlYWRXcml0ZS5BbGwgVXNlci5SZWFkIHByb2ZpbGUgb3BlbmlkIGVtYWlsIiwic2lnbmluX3N0YXRlIjpbImttc2kiXSwic3ViIjoiSlBSSWczTmR4V19jZmdnd0VSLVMyYXVIZ0pRUUZkaEtKb3RKcUpIYWl4ZyIsInRlbmFudF9yZWdpb25fc2NvcGUiOiJFVSIsInRpZCI6ImZiOTE0YmYzLTZhZmItNGE2My04NTJlLTUyZTMxYWJlNmQxMyIsInVuaXF1ZV9uYW1lIjoiQW5kcmlpUGFsYWRpaWNodWtARk9QUGFsYWRpaWNodWsub25taWNyb3NvZnQuY29tIiwidXBuIjoiQW5kcmlpUGFsYWRpaWNodWtARk9QUGFsYWRpaWNodWsub25taWNyb3NvZnQuY29tIiwidXRpIjoiQW8wb19DS3Zra2lRVHhheE9zUTNBQSIsInZlciI6IjEuMCIsIndpZHMiOlsiNjJlOTAzOTQtNjlmNS00MjM3LTkxOTAtMDEyMTc3MTQ1ZTEwIiwiYjc5ZmJmNGQtM2VmOS00Njg5LTgxNDMtNzZiMTk0ZTg1NTA5Il0sInhtc19zdCI6eyJzdWIiOiJZRU5vdndzRGtSVXZ0c3U1Y3JEU3dmVFplREk4bWo4VWxSV3YzeWpLcHVzIn0sInhtc190Y2R0IjoxNzE1ODYwNjU1fQ.SBJOJnHVNtMZzxRHwMJLX-UzS23a40CCOIZsyEl0oHjZtsam14vpNNlnORLay4SF_uhfiLlj432eUJCzWf5VBdiQZ-p7MUHViImO9vafurJMQ6Rqmt46mpkWg1vw1Zsu1TFbSFW-UC1HaDvB4b6Y5Waw4vjPrzWHXUbPySOVXSG3GwdRgFvYXevzUYY8Eqh47vShSdYeViGixb7MOX4_3tl_S0vUQodZRrkV7yczGxJscUJS2p29MZE-VzPX-yB8DfSD6t7BHEx9CSGGyd8fsDGVreL40xTsOc-4N4RJBYX67WMpLoc94BISvmjd8c7YaLH19O0w5g6KfJ9587uDpw",
		"token_type":    "Bearer",
		"refresh_token": "0.Aa8A80uR-_tqY0qFLlLjGr5tE1PUFiJSVm9JugnadFnEVMUdAQo.AgABAwEAAADnfolhJpSnRYB1SVj-Hgd8AgDs_wUA9P-BQJbLXNDnuZXooTaG3iKW-009NnPtaU9ZG_eIgpeRqkQ4iCZZliufaASnduohepHQtTlt97bN2WZUdRWty4jukOLlAnuqz7v606S_btyt371JURGtyMCKgh3EtGoVM_XQURsb6KrtlM_A21H9YWJU06Iw-9o_c71aLUnAVVlJgrIAvOAorY3aT9MYq6k_EV4ytiLWE6njEOlnzJ1hcPCpz8N5gFOBaLqf7dFHCsZYB9HzqQ2V0DuL_KE1Ud3pcSziXwMfgZXLoS58spreopivKkIPu1goffWtM_t9GHRiHfwt88OKqlUZJ-gdon50q-aGUQYvtizY94uFFbKQMpc29nODwI4xLSkZbRkUd6BNm67cf7a9X09fHn9l_TyQ50TXyH3drX6PqX7LLTplurqMIZy1E5y3xpp03egqbYD10kjDKPIXj1vog5X1JpSNCXJK-hoN7KeUhE-ef5g1uFDkYaPrtt4Ef9FBMMgs4NaIx3RiMr1Ku8XJW-QIJTCztdtv547cUWX8sbzY7_emC2jCSkyYGuSEBEJerNIxoT0faHZiLl6zFlb9pCxdyB05gdtCmHeB0JALM93OzQInYVgx96hv91PTg1UhB1buhvQzio3TczaAyw1MALthxEwxQsUoqXtKLxAY6DYPYvDQW_64AHsaO3AB-0cLjltf3zQV7s_gfso8GO_o0vQBvHQNX-Upt4tt8PHnvfWoQT9ThqKDyEXmYG1-wxbpwus5D9HoD_-GpsnkJyMRwm8yB9wWC2bqJDM_LHmQPehSYuqpgbhlgeGtScF9WUO9mwKQMUNkFqZLr7_epRw",
		"expiry":        "2024-05-24T12:24:33.327841375+03:00",
	},
}

func TestOneDrive_Execute(t *testing.T) {
	od, err := NewOneDrive(&model.Connector{
		ID:                      decimal.Decimal{},
		CredentialID:            decimal.NullDecimal{},
		Name:                    "",
		Source:                  "",
		ConnectorSpecificConfig: param,
	})
	assert.NoError(t, err)
	chResult := od.Execute(context.TODO(), nil)
	for data := range chResult {
		mtype := mimetype.Detect(data.Content)
		t.Logf("%s -- %s ", string(data.MimeType), mtype)

	}
}
